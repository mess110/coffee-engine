// Generated by CoffeeScript 1.4.0
var Engine;

Engine = (function() {

  function Engine(canvasId, width, height, tick, doMouseDown, doKeyDown) {
    this.time = void 0;
    this.width = width;
    this.height = height;
    this.backgroundColor = '#FFFFFF';
    this.canvasId = canvasId;
    this.canvas = document.getElementById(this.canvasId);
    addEventListener("keydown", doKeyDown, false);
    addEventListener("keyup", doKeyDown, false);
    this.canvas.addEventListener("mousedown", this.getPosition, false);
    this.canvas.addEventListener("mouseup", this.getPosition, false);
    this.canvas.setAttribute('tabindex', '0');
    this.canvas.width = width;
    this.canvas.height = height;
    this.context = this.canvas.getContext("2d");
    this.tick = tick;
    this.doMouseDown = doMouseDown;
  }

  Engine.prototype.getPosition = function(event) {
    var x, y;
    x = new Number();
    y = new Number();
    if (event.x !== undefined && event.y !== undefined) {
      x = event.x;
      y = event.y;
    } else {
      x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
      y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop;
    }
    x -= this.offsetLeft;
    y -= this.offsetTop;
    event.position = new Point(x, y);
    doMouseDown(event);
  };

  Engine.prototype.clear = function() {
    this.context.fillStyle = this.backgroundColor;
    this.context.fillRect(0, 0, this.width, this.height);
  };

  Engine.prototype.drawText = function(text) {
    this.context.fillStyle = "blue";
    this.context.font = "bold 16px Arial";
    this.context.fillText(text, 10, 30);
  };

  Engine.prototype.draw = function() {
    var now, tpf;
    requestAnimationFrame(Engine.prototype.draw);
    now = new Date().getTime();
    tpf = (now - (this.time || now)) / 1000;
    this.time = now;
    tick(tpf);
  };

  Engine.prototype.start = function() {
    this.draw();
  };

  return Engine;

})();

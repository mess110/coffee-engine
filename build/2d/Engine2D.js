// Generated by CoffeeScript 1.9.3
var Engine2D,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Engine2D = (function() {
  function Engine2D(canvasId, width, height, windowResize) {
    if (windowResize == null) {
      windowResize = false;
    }
    this.render = bind(this.render, this);
    this.onDocumentKeyboardEvent = bind(this.onDocumentKeyboardEvent, this);
    this.onDocumentMouseEvent = bind(this.onDocumentMouseEvent, this);
    this.sceneManager = SceneManager.get();
    this.time = void 0;
    this.width = width;
    this.height = height;
    this.backgroundColor = '#FFFFFF';
    this.canvasId = canvasId;
    document.addEventListener("mousedown", this.onDocumentMouseEvent, false);
    document.addEventListener("mouseup", this.onDocumentMouseEvent, false);
    document.addEventListener("mousemove", this.onDocumentMouseEvent, false);
    document.addEventListener("keydown", this.onDocumentKeyboardEvent, false);
    document.addEventListener("keyup", this.onDocumentKeyboardEvent, false);
    this.canvas = document.getElementById(this.canvasId);
    this.canvas.width = width;
    this.canvas.height = height;
    this.context = this.canvas.getContext("2d");
    if (windowResize) {
      window.addEventListener('resize', this.resize, false);
      this.resize();
    }
  }

  Engine2D.prototype.resize = function() {
    var canvasRatio, height, width, windowRatio;
    canvasRatio = this.canvas.height / this.canvas.width;
    windowRatio = window.innerHeight / window.innerWidth;
    width = void 0;
    height = void 0;
    if (windowRatio < canvasRatio) {
      height = window.innerHeight;
      width = height / canvasRatio;
    } else {
      width = window.innerWidth;
      height = width * canvasRatio;
    }
    this.canvas.style.width = width + 'px';
    return this.canvas.style.height = height + 'px';
  };

  Engine2D.prototype.onDocumentMouseEvent = function(event) {
    return this.sceneManager.currentScene().doMouseEvent(event);
  };

  Engine2D.prototype.onDocumentKeyboardEvent = function(event) {
    return this.sceneManager.currentScene().doKeyboardEvent(event);
  };

  Engine2D.prototype.clear = function() {
    this.context.fillStyle = this.backgroundColor;
    return this.context.fillRect(0, 0, this.width, this.height);
  };

  Engine2D.prototype.render = function() {
    var now, tpf;
    requestAnimationFrame(this.render);
    now = new Date().getTime();
    tpf = (now - (this.time || now)) / 1000;
    this.time = now;
    return this.sceneManager.tick(tpf);
  };

  return Engine2D;

})();
